<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:monodoc="http://www.go-mono.org/xml/monodoc">
<head>
	<title>GnomeDb - Desktop Database applications</title>

	<meta name = "DC.Description" content = "" />
	<meta name = "DC.Contributor" content = "Marius Andreiana" />

	<link rel="stylesheet" type="text/css" href="../../../style.css" />
</head>
<body> 

<h2>Contents</h2>
<ul>
	<li>1. <a href="#intro">Introduction</a></li>
	<li>2. <a href="#sample_app">A sample application</a></li>
	<li>3. <a href="#behind_scenes">Behind the scenes</a></li>
</ul>
<h3><a id="intro">Introduction</a></h3>
<a href="http://www.gnome-db.org">GnomeDb</a> offers database support for your desktop applications:
functions for running SQL and working with result sets, data-bound widgets, XML queries and a report engine.
<p />

<table border="0">
<tr>
	<td valign="top">
Glade offers support for GnomeDb widgets if it was compiled with GnomeDb libraries installed. In project options, check the box "Enable Gnome DB support".
The Glade palette with GnomeDb widgets is shown here. The tooltips reveal widget names.
<p />
As of december 2003, there are some problems with GnomeDb and Mono:
<ul>
<li>the current API is not documented. You can use the C API and Gtk# source to learn about it, and then please contribute some parts of the Mono API documentation.</li>
<li>libGlade doesn't have support for GnomeDb (<a href="http://bugzilla.gnome.org/show_bug.cgi?id=128633">see bug</a>). We'll use Glade to make our UI, but we'll pack manually the GnomeDb widgets.</li>
<li>there are no Mono bindings for Gda Reports. <a href="http://bugzilla.ximian.com/show_bug.cgi?id=51515">This bug</a> has a patch, but it's not working properly. Anyway, there is an alternative solution: you can get the query results as XML and use XSL to make plain text, HTML or PDF 
(with <a href="http://www.w3.org/TR/xsl/">XSL Formatting Objects</a> and <a href="http://xml.apache.org/fop/index.html">FOP</a>). I prefer XSL FO as it's a standard.</li>
<li>various bugs. Not everything works as it should. You'll see notes in this tutorial about it. Help is welcomed.</li>
</ul>
<p />
Overall though, GnomeDb is <i>the</i> solution for desktop database applications. You can also help making it better with API docs, bug fixes and new functionality. 
Version 1.2, scheduled for march 2004, will offer updatable data models, which will allow applications to modify data on the underlying data source without using any SQL at all, and user-defined forms for data displaying/modification.
</td>
	<td width="20"> </td>
	<td><img src="glade_gnomedb_palette.png" width="134" height="481" border="0" alt="" align="right" /></td>	
</tr>
</table>
	
<p />

<h3><a id="sample_app">A sample application</a></h3>
Let's see a sample application using PostgreSQL. First, create a database with this table:

<pre class="code">
CREATE TABLE customers (
        customer_id INT4 NOT NULL,
        name VARCHAR(256) NOT NULL,
        address VARCHAR(256) NOT NULL
);
  
CREATE UNIQUE INDEX customers_id_idx ON customers USING btree (customer_id);
</pre>
<p />

<table border="0">
<tr>
	<td valign="top">Then, make a Gnome project in Glade. We'll have clicked signals connected to the toolbar buttons. 
	This the <a href="gnomedb-sample.glade">the .glade file</a>, <a href="gnomedb-sample.gladep">.gladep</a> and you can see a screenshot of it.
</td>
	<td width="20"> </td>
	<td><img src="gnomedb-sample-project.png" width="229" height="224" border="0" alt="" align="right" /></td>	
</tr>
</table>
<p />
Here is <a href="gnomedb-sample.cs">the code</a> and <a href="gnomedb-sample.Makefile">Makefile</a>.
And screenshot of our application at run-time:
<p />
<img src="gnomedb-sample-runtime.png" border="0" alt="" />
<p />
It's a little crowded, but it shows many important widgets. Let's learn more about them.

<h3><a id="behind_scenes">Behind the scenes</a></h3>
In GnomeDbSample() the GnomeDb widgets are packed manually and the connection to database is initialized:
<pre class="code">
	client = new Gda.Client ();
	dbc = client.OpenConnection ("monotest", "mono", "mono",
	     Gda.ConnectionOptions.ReadOnly);
</pre>
The paramenters to OpenConnection() are libGda DSN (data source name), username and password and connection options. 
We can also connect to another database by pressing "Connect", which opens a dialog to define the connection.

<pre class="code">
	GnomeDb.LoginDialog dialog;
	dialog = new GnomeDb.LoginDialog( "Select data source" );
		
	if (dialog.Run() == true) {
		dbc = client.OpenConnection( dialog.Dsn, dialog.Username, dialog.Password,
					     Gda.ConnectionOptions.ReadOnly );
		if (dbc != null) {
			db_browser.Connection = dbc;
		}
	}
	dialog.Destroy();
</pre>
<p />
The GnomeDb.Grid widget is one of the most useful. Is shows the result, allows ordering and exporting as tab-delimited, comma-delimited or XML formats.
<p />
Current problems with it: sorting doesn't work on integer columns (sorts them as characters), RowSelected event works only for the first row, getting the list of selected rows doesn't work. 
This is the code:
<pre class="code">
/* row selected event */
db_grid.RowSelected += on_row_selected;
...
public static void on_row_selected( System.Object obj, GnomeDbSharp.RowSelectedArgs args )
{
	Console.WriteLine( "row selected" );
}

/* list selected rows */
GLib.List row_list;
row_list = db_grid.Selection;
Console.WriteLine( "Record count: " + row_list.Count );
foreach( int i in row_list ) {
	//crash here
}
</pre>
<p />
GnomeDb.List is the same, but it shows only one column of data. GnomeDb.Combo is a combo with data from a table column (note: you'll have to use CVS version of libgnomedb for this to work)
<p />

<p />
This tutorial will grow as the author learns more and GnomeDb gets better.
</body>
</html>
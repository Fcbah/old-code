<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:monodoc="http://www.go-mono.org/xml/monodoc">
<head>
	<title>開発者のバージョニング</title>
	<link rel="stylesheet" type="text/css" href="../style.css" />
</head>

<body>
<h1>開発者のバージョニング</h1>

  <p>
    というわけで、同じアセンブリの複数のバージョンをもつことは、ユーザーにとって良いことなのです: アセンブリのファイル名の衝突について心配する必要がなくなりますし、彼がソフトウェアをアップデートしたときに、既存のソフトウェアを壊すことなく、同一のアセンブリの複数のバージョンをインストールすることができるためです。
  </p>

  <p>
    しかし開発者はどのようにして複数バージョンのアセンブリに取り組む必要があるのでしょうか? また、コンパイラはどのように正しいバージョンのアセンブリをリンクするのでしょうか?
  </p>

  <p>
    コンパイラは、自らと同一のディレクトリ（デフォルトで /usr/lib/mono/1.0) で見つかったアセンブリを自動的にロードします。これには、全てのMonoの標準アセンブリについて当てはまります。ただし、サードパーティのアセンブリについては、リンクするアセンブリを含むディレクトリを、明示的に指定する必要があります。
  </p>

  <p>
    GACの世界では、アセンブリは2つの場所で公開されます。（ランタイムがアセンブリをロードするために使用する）GACがひとつで、<tt>gacutil</tt>コマンドの<tt>-package</tt>フラグによって指定される、コンパイラ毎に異なる位置を示される場所がひとつです。
  </p>

  <p> What the <tt>-package</tt> オプションで行われるのは、アセンブリをコンパイラによって選ばれる、実際の入力には適さない別々の位置にアセンブリを公開することです（デフォルトでは、アセンブリは暗号のような位置にのみ公開されます。たとえば /usr/lib/mono/gac/monodoc/1.0.0.0__0738eb9f132ed756/monodoc.dll などです）。
  <tt>-package NAME</tt>オプションは、アセンブリを（シンボリックリンクを使用して）
  /usr/lib/mono/NAME ディレクトリから見えるようにします。これはコンパイラにアセンブリを渡すのに便利な場所です。
  </p>

  <p>
    Unixのビルドプロセスにさらに統合するために、私たちは一歩先に進んで、<tt>-package</tt>オプションでアセンブリを公開されたGACにインストールする以外にも、<tt>pkg-config</tt>コンフィグレーションファイルを同時に配布するという選択肢を開発者が選べるようにしました。pkg-configコンフィグレーションファイルは、そのアセンブリをビルドするために必要な情報を全て含んでいます。
  </p>

  <p>これはコンパイラ フラグ <tt>-pkg</tt>と結びつけて、ソフトウェアパッケージを直接に参照するというかたちで、利用することができます。たとえば、Gtk#とPango#を使ってコンパイルする場合は、使用されるコマンドラインは次のようになります:
  </p>

<pre class="console">
$ mcs -pkg:gtk-sharp,pango-sharp sample.cs
Compilation succeeded
$ 
</pre>

  <p>
    以上は、開発者がパスを覚えておかなくてもいいように、あるいはパスを推測するために、便宜を図ったものです。彼らは、単にコンフィグレーション スクリプト上でpkg-configを使って、アセンブリ位置のプローブ（推測）を、必要に応じて特定のバージョンを指定して、実現することが出来ます。
  </p>

  <p>
    gtk-sharp.pcファイルは、（ほとんどのシステムで）/usr/lib/pkgconfig ディレクトリ、あるいはPKG_CONFIG_PATHで指定される任意のディレクトリに、インストールされるべきファイルです。これは、開発者が複数の開発バージョンを同時にインストールし、正しいバージョンを.pcファイルに基づいてコンパイラに選択させることを可能にします。
  </p>

  <p>
    以下は、gtk-sharp.pcがどのようなものであるかを示しています:
  </p>

<pre class="code">
prefix=/usr
exec_prefix=${prefix}
libdir=${exec_prefix}/lib


Name: Gtk#
Description: Gtk# - GNOME .NET Binding
Version: 0.91.99
Libs: -r:${libdir}/mono/gtk-sharp/glib-sharp.dll     \
	-r:${libdir}/mono/gtk-sharp/pango-sharp.dll  \
	-r:${libdir}/mono/gtk-sharp/atk-sharp.dll    \
	-r:${libdir}/mono/gtk-sharp/gdk-sharp.dll    \
	-r:${libdir}/mono/gtk-sharp/gtk-sharp.dll
</pre>
 
  <p>
    アセンブリが、 -lib: コマンドを経由せず、-r オプションで別々に直接に参照されていることに注意してください。これは、リンクされるアセンブリを正確に指定することを可能にしているのです。
  </p>


</body>
</html>

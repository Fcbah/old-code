<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:monodoc="http://www.go-mono.org/xml/monodoc">
<head>
	<title>Gtk# - Miscellaneous Widgets - Calendar</title>

	<meta name ="DC.Description" content ="" />
	<meta name ="DC.Contributor" content ="Johannes Roith" />

	<link rel="stylesheet" type="text/css" href="../../../style.css" />
</head>
<body>

<p>The Calendar widget is an effective way to display and retrieve
monthly date related information. It is a very simple widget to create
and work with.</p>
<p>Creating a GtkCalendar widget is a simple as:</p>
<pre class="code">
Gtk.Calendar calendar = new Gtk.Calendar();
</pre>
<p>There might be times where you need to change a lot of information
within this widget and the following functions allow you to make
multiple change to a Calendar widget without the user seeing multiple
on-screen updates.</p>
<p>So, you can use</p>
<pre class="code">
calendar.Freeze();
</pre>
<p>and</p>
<pre class="code">
calendar.Thaw();
</pre>
<p>just like the freeze/thaw functions of every other widget.</p>

<p>The Calendar widget has a few options that allow you to change the way
the widget both looks and operates by using the property DisplayOptions.</p>
<p>The <tt class="LITERAL">flags</tt> argument can be formed by 
combining either of the following five options defined in the Gtk.CalendarDisplayOptions
struct, using the logical bitwise OR (|) operation:</p>

<DIV CLASS="VARIABLELIST">
<DL>
<dt><tt class="LITERAL">ShowHeading</tt></dt>
<dd><p>this option specifies that the month and year should be shown 
when drawing the calendar.</p></dd>
<dt><tt class="LITERAL">ShowDayNames</tt></dt>
<dd><p>this option specifies that the three letter descriptions should 
be displayed for each day (eg Mon,Tue, etc.).</p></dd>
<dt><tt class="LITERAL">NoMonthChange</tt></dt>
<dd><p>this option states that the user
should not and can not change the currently displayed month. This can
be good if you only need to display a particular month such as if you
are displaying 12 calendar widgets for every month in a particular
year.</p></dd>
<dt><tt class="LITERAL">ShowWeekNumbers</tt></dt>
<dd><p>this option specifies that the
number for each week should be displayed down the left side of the
calendar. (eg. Jan 1 = Week 1,Dec 31 = Week 52).</p></dd>
<dt><tt class="LITERAL">WeekStartMonday</tt></dt>
<dd><p>this option states that the
calander week will start on Monday instead of Sunday which is the
default. This only affects the order in which days are displayed from
left to right.</p></dd>
</DL>
</DIV>

<p>The following methods are used to set the the currently displayed
date:</p>
<pre class="code">
bool SelectMonth(uint month, uint year);

void SelectDay(uint day);
</pre>

<p>The return value from <tt class="LITERAL">SelectMonth()</tt> is a boolean
value indicating whether the selection was successful.</p>
<p>With <tt class="LITERAL">SelectDay()</tt> the specified day number is
selected within the current month, if that is possible. A 
<tt class="LITERAL">day</tt> value of 0 will deselect any current selection.</p>
<p>In addition to having a day selected, any number of days in the month
may be "marked". A marked day is highlighted within the calendar
display. The following methods are provided to manipulate marked
days:</p>

<pre class="code">
bool MarkDay(uint day);

bool UnmarkDay(uint day);

void ClearMarks();
</pre>

<!-- this segment does not yet apply to gtk-sharp :
<p>The currently marked days are stored within an array within the
Gtk.Calendar structure. This array is 31 elements long so to test
whether a particular day is currently marked, you need to access the
corresponding element of the array (don't forget in C that array
elements are numbered 0 to n-1). For example:</p>

<pre class="code">
    Gtk.Calendar calendar = new Gtk.Calendar();

    ...

    /* Is day 7 marked? */
    if (calendar.marked_date[7-1])
       /* day is marked */
</PRE>
-->
<p>Note that marks are persistent across month and year changes.</p>
<p>The final Calendar widget function is used to retrieve the currently
selected date, month and/or year.</p>

<pre class="code">
void GetDate( ref uint year, ref uint month, ref uint day);
</pre>
<p>This function requires you to pass the addresses of 
<tt class="LITERAL">guint</tt> variables, into which the result will 
be placed. Passing <tt class="LITERAL">null</tt> as
a value will result in the corresponding value not being returned.</p>

<p>You also can use</p>
<pre class="code">
System.DateTime GetDate();
</pre>
<p>and get a <tt class="LITERAL">DateTime</tt> variable with the currently 
selected date</p>

<p>The Calendar widget can generate a number of signals indicating date
selection and change. The names of these signals are self explanatory,
and are:</p>
<p></p>
<UL>
<li><p> <tt class="LITERAL">MonthChanged</tt></p></li>
<li><p> <tt class="LITERAL">DaySelected</tt></p></li>
<li><p> <tt class="LITERAL">DaySelectedDoubleClick</tt></p></li>
<li><p> <tt class="LITERAL">PrevMonth</tt></p></li>
<li><p> <tt class="LITERAL">NextMonth</tt></p></li>
<li><p> <tt class="LITERAL">PrevYear</tt></p></li>
<li><p> <tt class="LITERAL">NextYear</tt></p></li>
</UL>
<p>That just leaves us with the need to put all of this together into
example code.</p>

<pre class="code">
// calendar.cs - GTK# Tutorial example
//
// Ported from Calendar Widget example for GTK+ 2.0 Tutorial 
// by Ugo Albarello (ugo.albarello@007mundo.com)


using GLib;
using Gtk;
using System;
	
class testCalendar {
	public struct CalendarData {
		public CheckButton[] flag_checkboxes ;
		public bool[] settings;
		public string font;
		public Gtk.FontSelectionDialog font_dialog;
		public Gtk.Calendar window;
		public Gtk.Label prev2_sig;
		public Gtk.Label prev_sig;
		public Gtk.Label last_sig;
		public Gtk.Label month;
	}
	
	static CalendarData calendar_data = new CalendarData();
	static void create_calendar()
	{
		int i;
		uint DEF_PAD = 10;
		uint DEF_PAD_SMALL = 5;
		
		string[] flags = { "Show Heading" ,
			 "Show Day Names" ,
			 "No Month Change" ,
			 "Show Week Numbers",
			 "Week Start Monday" };
		
		calendar_data.window = null;
		calendar_data.font = null;
		calendar_data.font_dialog = null;
		
		calendar_data.flag_checkboxes = new CheckButton[5];
		calendar_data.settings = new bool[5];
		for (i = 0; i &lt; 5; i++) {
			calendar_data.settings[i] = false;
		}

		Gtk.Window window = new Gtk.Window("GtkCalendar Example");
		window.BorderWidth = 5;
		window.DeleteEvent += delete_event;
		
		window.Resizable = false;
		VBox vbox = new VBox (false, (int) DEF_PAD);
		window.Add(vbox);
		
		/*
		* The top part of the window, Calendar, flags and fontsel.
		*/
		
		HBox hbox = new HBox (false, (int) DEF_PAD);
		vbox.PackStart(hbox, true, true, DEF_PAD);
		
		HButtonBox hbbox = new HButtonBox();
		hbox.PackStart(hbbox, false, false, DEF_PAD);
		hbbox.Layout = Gtk.ButtonBoxStyle.Spread;
		hbbox.Spacing = 5;
		
		/* Calendar widget */
		Frame frame = new Frame("Calendar");
		hbbox.PackStart(frame, false, true, DEF_PAD);
		
		Calendar calendar = new Calendar();

		calendar_data.window = calendar;
		calendar_set_flags (calendar_data);
		
		calendar.MarkDay(19);
		
		frame.Add(calendar);
		
		calendar.MonthChanged += calendar_month_changed;
		calendar.DaySelected +=  calendar_day_selected;
		calendar.DaySelectedDoubleClick += day_selected_double_click;
		calendar.PrevMonth += calendar_prev_month;
		calendar.NextMonth += calendar_next_month;
		calendar.PrevYear += calendar_prev_year;
		calendar.NextYear += calendar_next_year;
		
		VSeparator separator = new VSeparator();
		hbox.PackStart(separator, false,true,0);
		
		/* Build the Right frame with the flags in */ 
		frame = new Frame ("Flags");
		hbox.PackStart(frame, true, true, DEF_PAD);
		VBox vbox3 = new VBox(true, (int) DEF_PAD_SMALL);
		frame.Add(vbox3);
		
		for (i = 0; i &lt; 5; i++) {
			CheckButton toggle = new CheckButton(flags[i]);
			toggle.Toggled += calendar_toggle_flag;
			vbox3.PackStart(toggle, true, true, 0);
			calendar_data.flag_checkboxes[i] = toggle;
		}
		
		/*
		*  Build the Signal-event part.
		*/
		frame = new Frame ("Signal events");
		vbox.PackStart(frame, true, true, DEF_PAD);
		
		VBox vbox2 = new VBox (true, (int) DEF_PAD_SMALL);
		frame.Add(vbox2);
		
		hbox = new HBox (false, 3);
		vbox2.PackStart(hbox, false, true, 0);
		Label label;
		label = new Label("Signal:");
		hbox.PackStart(label, false, true, 0);
		calendar_data.last_sig = new Label("");
		hbox.PackStart(calendar_data.last_sig, false, true, 0);
		
		hbox = new HBox (false, 3);
		vbox2.PackStart(hbox, false, true, 0);
		label = new Label("Previous Signal:");
		hbox.PackStart(label, false, true, 0);
		calendar_data.prev_sig = new Label("");
		hbox.PackStart(calendar_data.prev_sig, false, true, 0);
		
		hbox = new HBox (false, 3);
		vbox2.PackStart(hbox, false, true, 0);
		label = new Label("Second Previous Signal:");
		hbox.PackStart(label, false, true, 0);
		calendar_data.prev2_sig = new Label("");
		hbox.PackStart(calendar_data.prev2_sig, false, true, 0);
		
		HButtonBox bbox = new HButtonBox();
		vbox.PackStart(bbox, false, false, 0);
		bbox.Layout = Gtk.ButtonBoxStyle.End;
		
		Button button = new Button("Close");
		button.Clicked += button_click;
		bbox.Add(button);
		button.CanDefault = true;
		button.GrabDefault();
		
		window.ShowAll();
		
	}
	
	
	static void Main()
	{
		Application.Init ();

		/* create a new window */
		create_calendar();
		
		Application.Run ();
	}

	static void button_click (object obj, EventArgs args)
	{
		Application.Quit ();
	}

	static void calendar_set_signal_strings( string sig_str)	{
		string prev_sig;
		
		prev_sig = calendar_data.prev_sig.Text;
		calendar_data.prev2_sig.Text = prev_sig;
		
		prev_sig = calendar_data.last_sig.Text;
		calendar_data.prev_sig.Text = prev_sig;
		
		calendar_data.last_sig.Text = sig_str;
	}

	static string calendar_date_to_string( string buffer) {
		System.DateTime time;
		
		time = calendar_data.window.GetDate();
		return buffer + time.ToString();
	}
	
	static void calendar_month_changed(object obj, EventArgs args) {
		string buffer = "month_changed: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}
	
	static void calendar_day_selected( object obj, EventArgs args) {
		string buffer = "day_selected: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}

	static void day_selected_double_click(object obj, EventArgs args) {
		string buffer = "double_click: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}
	
	static void calendar_prev_month(object obj, EventArgs args) {
		string buffer = "prev_month: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}
	
	static void calendar_next_month(object obj, EventArgs args) {
		string buffer = "next_month: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}
	
	static void calendar_prev_year(object obj, EventArgs args) {
		string buffer = "prev_year: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}
	
	static void calendar_next_year(object obj, EventArgs args) {
		string buffer = "next_year: ";
		buffer = calendar_date_to_string (buffer);
		calendar_set_signal_strings (buffer);
	}

	
	static void calendar_set_flags( CalendarData calendar ) {
		int i;
		int options = 0;
		for (i = 0; i &lt; 5; i++) 
			if (calendar.settings[i])
				{
					options=options + (1&lt;&lt;i);
				}
		//if (calendar.window != null)
			calendar.window.DisplayOptions = (Gtk.CalendarDisplayOptions) options;
	}

	static void calendar_toggle_flag(object toggle, EventArgs args) {
		int i;
		int j;
		j = 0;
		for (i = 0; i &lt; 5; i++)
			if (calendar_data.flag_checkboxes[i] == toggle)
				j = i;
		
		calendar_data.settings[j] = !calendar_data.settings[j];
		calendar_set_flags (calendar_data);
		
	}
	
	static void delete_event (object obj, DeleteEventArgs args)
	{
		Application.Quit ();
	}

}
</pre>

</body>
</html>
